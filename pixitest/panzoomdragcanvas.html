
<html>
<head>
	<title>pixi.js example 2</title>
	<style>
		body {
			margin: 6;
			padding: 6;
			background-color: #FFFFFF;
		}
	</style>
	
	<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

	<script src='pixi.js'></script>

</head>
<body>
  <canvas id='canvas'></canvas>

	<script>
var canvas = document.getElementById('canvas');
var renderer = PIXI.autoDetectRenderer(document.body.clientWidth-25, document.body.clientHeight-25, {view:canvas});
document.body.appendChild(renderer.view);

var stage = new PIXI.Container();
//stage.interactive = true;
//stage.click = function(){
	
	//}
	//stage
        //.on('mousedown', onDragStart2)
        //.on('touchstart', onDragStart2)
        //// events for drag end
        //.on('mouseup', onDragEnd2)
        //.on('mouseupoutside', onDragEnd2)
        //.on('touchend', onDragEnd2)
        //.on('touchendoutside', onDragEnd2)
        //// events for drag move
        //.on('mousemove', onDragMove2)
        //.on('touchmove', onDragMove2);

var texture = PIXI.Texture.fromImage('bunny.png');



stage.width = document.body.clientWidth;
stage.height = document.body.clientHeight;

var world = new PIXI.Container();
world.visible = true;
world.buttonMode = true;
world.render = true;
world.interactive = true;
world.position.x = 100;
world.position.y = 100;
world.width = 800;
world.height = 600;
world.scale = new PIXI.Point(1,1)
	world
        .on('mousedown', onDragStart2)
        .on('touchstart', onDragStart2)
        // events for drag end
        .on('mouseup', onDragEnd2)
        .on('mouseupoutside', onDragEnd2)
        .on('touchend', onDragEnd2)
        .on('touchendoutside', onDragEnd2)
        // events for drag move
        .on('mousemove', onDragMove2)
        .on('touchmove', onDragMove2);

document.addEventListener("mousewheel", mouseWheelHandler, false);
var SCALE_MIN = 0
var SCALE_MAX = 10

function mouseWheelHandler(e) {
	console.log(e)
	// cross-browser wheel delta
	var e = window.event || e;
	var delta = e.wheelDelta > 0 ? 1.1 : 0.9;
	var worldPos = {x: (e.pageX - world.x) / world.scale.x, y: (e.pageY - world.y)/world.scale.y}
	var newScale = {x: world.scale.x * delta, y: world.scale.y * delta}
	var newScreenPos = {x: (worldPos.x ) * newScale.x + world.x, y: (worldPos.y) * newScale.y + world.y}
	world.x -= (newScreenPos.x-e.pageX ) 
	world.y -= (newScreenPos.y-e.pageY ) 
	world.scale.x = newScale.x;
	world.scale.y = newScale.y;
	}

function keyboard(keyCode) {
  var key = {};
  key.code = keyCode;
  key.isDown = false;
  key.isUp = true;
  key.press = undefined;
  key.release = undefined;
  //The `downHandler`
  key.downHandler = function(event) {
    if (event.keyCode === key.code) {
      if (key.isUp && key.press) key.press();
      key.isDown = true;
      key.isUp = false;
    }
    event.preventDefault();
  };

  //The `upHandler`
  key.upHandler = function(event) {
    if (event.keyCode === key.code) {
      if (key.isDown && key.release) key.release();
      key.isDown = false; 
      key.isUp = true;
    }
    event.preventDefault();
  };

  //Attach event listeners
  window.addEventListener(
    "keydown", key.downHandler.bind(key), false
  );
  window.addEventListener(
    "keyup", key.upHandler.bind(key), false
  );
  return key;
}

 var left = keyboard(37),
      up = keyboard(38),
      right = keyboard(39),
      down = keyboard(40);
      space = keyboard(32)
 
  left.press = function() {
	  world.position.x += 10
  }
  right.press = function() {
	  world.position.x -= 10
  }
	up.press = function() {
	  world.position.y += 10
  }
  down.press = function() {
	  world.position.y -= 10
  }
  space.press = function() {
	  world.position.x = 100
	  world.position.y = 100
	  world.scale = new PIXI.Point(1,1)
	  

	  }
	  
var graphics = new PIXI.Graphics();

for (var x = 0; x < 800; x+=5){
	for (var y = 0; y < 600; y +=5){
		graphics.lineStyle(0.5);
		graphics.beginFill(0xFFFF0B, 0.5);
		graphics.drawRect(x-0.5 ,y-0.5 ,5,5);
		graphics.endFill();
	}
}

world.addChild(graphics)

for (var i = 0; i < 1; i++)
{
    createBunny(100,100);
}


function keyturn(){
	if (left.isDown){
		left.press()}
	if (right.isDown){
		right.press()}
	if (up.isDown){
		up.press()}
	if (down.isDown){
		down.press()}	
}
function createBunny(x, y)
{
    // create our little bunny friend..
    var bunny = new PIXI.Sprite(texture);

    // enable the bunny to be interactive... this will allow it to respond to mouse and touch events
    bunny.interactive = true;

    // this button mode will mean the hand cursor appears when you roll over the bunny with your mouse
    bunny.buttonMode = true;

    // center the bunny's anchor point
    bunny.anchor.set(0.5);

    // make it a bit bigger, so it's easier to grab
    bunny.scale.set(1);
    
    // setup events
    bunny
        // events for drag start
        .on('mousedown', onDragStart)
        .on('touchstart', onDragStart)
        // events for drag end
        .on('mouseup', onDragEnd)
        .on('mouseupoutside', onDragEnd)
        .on('touchend', onDragEnd)
        .on('touchendoutside', onDragEnd)
        // events for drag move
        .on('mousemove', onDragMove)
        .on('touchmove', onDragMove);

    // move the sprite to its designated position
    bunny.position.x = x;
    bunny.position.y = y;

    // add it to the stage
    world.addChild(bunny);
}
stage.addChild(world);

requestAnimationFrame( animate );

function animate() {

    requestAnimationFrame(animate);
	keyturn()
    // render the stage
    renderer.render(stage);
}

function onDragStart(event)
{
	event.stopPropagation();
    // store a reference to the data
    // the reason for this is because of multitouch
    // we want to track the movement of this particular touch
    this.data = event.data;
    this.myclick = this.data.getLocalPosition(this)
    this.myx = this.myclick.x
    this.myy = this.myclick.y
    var newPosition = this.data.getLocalPosition(this.parent)
	        


    this.alpha = 0.5;
    this.dragging = true;


}

function onDragStart2(event)
{
	event.stopPropagation();
    // store a reference to the data
    // the reason for this is because of multitouch
    // we want to track the movement of this particular touch
    this.data = event.data;
    this.myclick = this.data.getLocalPosition(this)
    this.myx = this.myclick.x
    this.myy = this.myclick.y
        var newPosition = this.data.getLocalPosition(this.parent)

    this.dragging = true;
}


function onDragEnd()
{
    this.alpha = 1;


    this.dragging = false;
	
    // set the interaction data to null
    this.data = null;
}

function onDragEnd2()
{
    this.alpha = 1;

    this.dragging = false;
    // set the interaction data to null
    this.data = null;
}

function onDragMove()
{
    if (this.dragging)
    {
        var newPosition = this.data.getLocalPosition(this.parent)
        this.position.x = Math.ceil(newPosition.x - this.myx);
        this.position.y = Math.ceil(newPosition.y - this.myy)
        
    }
}

function onDragMove2()
{
    if (this.dragging)
    {
        var newPosition = this.data.getLocalPosition(this.parent);
        this.position.x = Math.ceil(newPosition.x - this.myx * this.scale.x);
        this.position.y = Math.ceil(newPosition.y - this.myy * this.scale.y)
        
    }
}

	</script>
 
	</body>
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69187416-1', 'auto');
  ga('send', 'pageview');

</script>
</html>
